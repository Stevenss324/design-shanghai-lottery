<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Design Shanghai 2026 Â· æ–°å¹´ç­¾è¿åŠ¿</title>
    <!-- å¾®ä¿¡åˆ†äº«JS-SDK -->
    <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", STHeiti, "Microsoft Yahei", Tahoma, Simsun, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 420px;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 24px;
            padding: 40px 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,215,0,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .logo {
            font-size: 16px;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
        }

        /* å¼€å§‹é¡µ */
        #startPage .envelope {
            width: 200px;
            height: 200px;
            margin: 30px auto;
            position: relative;
        }

        .envelope-img {
            font-size: 150px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 60px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        /* æŠ½ç­¾é¡µ */
        #drawPage {
            display: none;
        }

        .fortune-sticks {
            width: 250px;
            height: 250px;
            margin: 30px auto;
            position: relative;
        }

        .stick {
            position: absolute;
            width: 8px;
            height: 180px;
            background: linear-gradient(to bottom, #D4AF37, #FFD700);
            border-radius: 4px;
            bottom: 20px;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .stick:nth-child(1) { left: 80px; }
        .stick:nth-child(2) { left: 100px; }
        .stick:nth-child(3) { left: 120px; }
        .stick:nth-child(4) { left: 140px; }
        .stick:nth-child(5) { left: 160px; }

        .stick.shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        .stick.picked {
            transform: translateY(-100px) scale(1.2);
            background: linear-gradient(to bottom, #FFD700, #FFA500);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
        }

        /* ç»“æœé¡µ */
        #resultPage {
            display: none;
        }

        .result-icon {
            font-size: 100px;
            margin: 20px 0;
            animation: scaleIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes scaleIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .fortune-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .fortune-desc {
            font-size: 18px;
            color: #555;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .coupon-box {
            background: linear-gradient(135deg, #FFF5E1 0%, #FFE4B5 100%);
            border: 2px dashed #D4AF37;
            border-radius: 16px;
            padding: 25px;
            margin: 30px 0;
        }

        .coupon-label {
            font-size: 14px;
            color: #D4AF37;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .coupon-code {
            font-size: 28px;
            font-weight: 700;
            color: #D4AF37;
            letter-spacing: 3px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }

        .coupon-desc {
            font-size: 14px;
            color: #999;
        }

        .share-tip {
            background: #F0F7FF;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            font-size: 14px;
            color: #667eea;
            line-height: 1.6;
        }

        .share-tip strong {
            color: #764ba2;
            font-size: 16px;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            flex: 1;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        #startPage .btn-secondary {
            background: linear-gradient(135deg, #FFF5E1 0%, #FFE4B5 100%);
            color: #D4AF37;
            border: 2px solid #D4AF37;
        }

        #startPage .btn-secondary:hover {
            background: linear-gradient(135deg, #D4AF37 0%, #FFD700 100%);
            color: white;
            border-color: #D4AF37;
        }

        .btn-primary {
            flex: 1;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 13px;
            color: rgba(255,255,255,0.8);
        }

        .hidden {
            display: none;
        }

        /* å¤åˆ¶æˆåŠŸæç¤º */
        .copy-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            transition: all 0.3s;
            z-index: 1000;
        }

        .copy-toast.show {
            transform: translate(-50%, -50%) scale(1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- å¼€å§‹é¡µ -->
            <div id="startPage">
                <div class="logo">DESIGN SHANGHAI 2026</div>
                <h1>ğŸ§§ æ–°å¹´ç­¾è¿åŠ¿</h1>
                <p class="subtitle">é©¬åˆ°æˆåŠŸå¹´ Â· çµæ„Ÿå¯æ–°ç¯‡</p>
                
                <div class="envelope">
                    <div class="envelope-img">ğŸ®</div>
                </div>
                
                <button class="btn" onclick="startDraw()">æŠ½å–æ–°å¹´ç­¾</button>
                
                <p style="margin-top: 30px; font-size: 14px; color: #999;" id="drawCountText">
                    æŠ½å–å±äºä½ çš„æ–°å¹´ç¦åˆ©ï¼
                </p>
                
                <button class="btn btn-secondary" onclick="shareToFriend()" style="margin-top: 20px; padding: 12px 40px; font-size: 16px;">
                    ğŸ“¤ åˆ†äº«ç»™å¥½å‹è·å¾—é¢å¤–æœºä¼š
                </button>
            </div>

            <!-- æŠ½ç­¾é¡µ -->
            <div id="drawPage">
                <div class="logo">DESIGN SHANGHAI 2026</div>
                <h1>ğŸ‹ æ‘‡ç­¾ä¸­...</h1>
                <p class="subtitle">å¥½è¿å³å°†æ­æ™“</p>
                
                <div class="fortune-sticks">
                    <div class="stick"></div>
                    <div class="stick"></div>
                    <div class="stick"></div>
                    <div class="stick"></div>
                    <div class="stick"></div>
                </div>
            </div>

            <!-- ç»“æœé¡µ -->
            <div id="resultPage">
                <div class="logo">DESIGN SHANGHAI 2026</div>
                
                <div class="result-icon" id="resultIcon">ğŸ‰</div>
                <div class="fortune-title" id="fortuneTitle">å¤§å‰</div>
                <p class="fortune-desc" id="fortuneDesc">é©¬åˆ°æˆåŠŸï¼Œçµæ„Ÿçˆ†æ£šï¼</p>
                
                <div class="coupon-box">
                    <div class="coupon-label">ğŸ ä¸“å±ç¦åˆ©</div>
                    <div class="coupon-code" id="couponCode">HORSE2026</div>
                    <div class="coupon-desc" id="couponDesc">å…è´¹é—¨ç¥¨ 1å¼ </div>
                </div>
                
                <div class="share-tip">
                    ğŸ’¡ <strong>åˆ†äº«ç¦åˆ©ï¼š</strong><br>
                    åˆ†äº«ç»™å¥½å‹ï¼Œè·å– <strong>+1æ¬¡æŠ½å¥–æœºä¼š</strong><br>
                    æœ€å¤šå¯åˆ†äº«ç»™5ä½å¥½å‹
                </div>
                
                <!-- ä¸­å¥–æ—¶æ˜¾ç¤ºçš„æŒ‰é’® -->
                <div class="btn-group" id="btnGroup1">
                    <button class="btn btn-secondary" id="copyCodeBtn" onclick="copyCode()">å¤åˆ¶ä¼˜æƒ ç </button>
                    <button class="btn btn-primary" onclick="buyTicket()">ç«‹å³è´­ç¥¨</button>
                </div>
                
                <!-- æœªä¸­å¥–æ—¶æ˜¾ç¤ºçš„æŒ‰é’® -->
                <div class="btn-group" id="btnGroup2" style="display: none; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="shareToFriend()" style="flex: 1;">
                        ğŸ“¤ åˆ†äº«è·å¾—æœºä¼š
                    </button>
                    <button class="btn" onclick="restart()" style="flex: 1;">
                        å†æŠ½ä¸€æ¬¡
                    </button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            Â© 2026 è®¾è®¡ä¸Šæµ· Design Shanghai
        </div>
    </div>

    <!-- å¤åˆ¶æˆåŠŸæç¤º -->
    <div class="copy-toast" id="copyToast">âœ“ å·²å¤åˆ¶ä¼˜æƒ ç </div>

    <script>
        // è¿åŠ¿é…ç½®ï¼ˆå¸¦é¢åº¦é™åˆ¶ï¼‰
        const fortunes = [
            {
                level: 'å¤§å‰',
                icon: 'ğŸ‰',
                desc: 'é©¬åˆ°æˆåŠŸï¼Œçµæ„Ÿçˆ†æ£šï¼<br>2026å¹´ä½ å°†é‡è§æœ€inspiringçš„è®¾è®¡',
                coupon: 'HORSE2026',
                discount: 'å…è´¹é—¨ç¥¨ 1å¼ ',
                probability: 0.02,  // 2%
                quota: 10,  // æ€»é¢åº¦
                used: 0,    // å·²ä½¿ç”¨
                isWinning: true  // æ˜¯å¦ä¸ºä¸­å¥–
            },
            {
                level: 'å‰',
                icon: 'ğŸ§§',
                desc: 'å“è´¨ç”Ÿæ´»ï¼Œä»è®¾è®¡å¼€å§‹<br>å‘ç°ç”Ÿæ´»ä¸­çš„ç¾å¥½ç»†èŠ‚',
                coupon: 'HORSE',
                discount: '8æŠ˜è´­ç¥¨åˆ¸',
                probability: 0.18,  // 18%
                quota: 200,
                used: 0,
                isWinning: true
            },
            {
                level: 'å°å‰',
                icon: 'ğŸŒŸ',
                desc: 'åˆ›æ„èŒèŠ½ï¼Œçµæ„Ÿæ¶Œç°<br>è®¾è®¡ä¹‹æ—…ä»è¿™é‡Œå¼€å§‹',
                coupon: 'LUCKY',
                discount: '9æŠ˜è´­ç¥¨åˆ¸',
                probability: 0.30,  // 30%
                quota: 500,
                used: 0,
                isWinning: true
            },
            {
                level: 'é¡º',
                icon: 'ğŸ',
                desc: 'ä¸€åˆ‡é¡ºåˆ©ï¼Œå¥½è¿åœ¨è·¯ä¸Š<br>å†è¯•ä¸€æ¬¡ï¼ŒæƒŠå–œå°±åœ¨ä¸‹ä¸€ç­¾',
                coupon: '',
                discount: 'è°¢è°¢æƒ é¡¾',
                probability: 0.50,  // 50%
                quota: 999999,  // æ— é™é¢åº¦
                used: 0,
                isWinning: false  // éä¸­å¥–ï¼Œå¯ä»¥ç»§ç»­æŠ½
            }
        ];

        // ä»localStorageè¯»å–å·²ä½¿ç”¨çš„é¢åº¦
        function loadQuotas() {
            try {
                const savedQuotas = localStorage.getItem('fortuneQuotas');
                if (savedQuotas) {
                    const quotas = JSON.parse(savedQuotas);
                    fortunes.forEach((fortune, index) => {
                        if (quotas[index] !== undefined) {
                            fortune.used = quotas[index];
                        }
                    });
                }
            } catch (e) {
                console.log('åŠ è½½é¢åº¦å¤±è´¥');
            }
        }

        // ä¿å­˜é¢åº¦åˆ°localStorage
        function saveQuotas() {
            try {
                const quotas = fortunes.map(f => f.used);
                localStorage.setItem('fortuneQuotas', JSON.stringify(quotas));
            } catch (e) {
                console.log('ä¿å­˜é¢åº¦å¤±è´¥');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è¯»å–é¢åº¦
        loadQuotas();

        // æ¯æ—¥æŠ½å¥–æ¬¡æ•°ç®¡ç†
        const DAILY_BASE_DRAWS = 3;  // æ¯æ—¥åŸºç¡€æ¬¡æ•°
        const MAX_SHARE_DRAWS = 5;   // æœ€å¤šåˆ†äº«è·å¾—æ¬¡æ•°
        
        let drawCount = {
            date: '',
            baseUsed: 0,      // å·²ä½¿ç”¨çš„åŸºç¡€æ¬¡æ•°
            shareUsed: 0,     // å·²ä½¿ç”¨çš„åˆ†äº«æ¬¡æ•°
            shareEarned: 0,   // å·²è·å¾—çš„åˆ†äº«æ¬¡æ•°
            hasWon: false     // ä»Šæ—¥æ˜¯å¦å·²ä¸­å¥–
        };

        // åŠ è½½æŠ½å¥–æ¬¡æ•°
        function loadDrawCount() {
            try {
                const saved = localStorage.getItem('drawCount');
                if (saved) {
                    const data = JSON.parse(saved);
                    const today = new Date().toDateString();
                    
                    // å¦‚æœæ˜¯æ–°çš„ä¸€å¤©ï¼Œé‡ç½®æ¬¡æ•°
                    if (data.date === today) {
                        drawCount = data;
                    } else {
                        drawCount.date = today;
                        saveDrawCount();
                    }
                } else {
                    drawCount.date = new Date().toDateString();
                    saveDrawCount();
                }
            } catch (e) {
                drawCount.date = new Date().toDateString();
            }
        }

        // ä¿å­˜æŠ½å¥–æ¬¡æ•°
        function saveDrawCount() {
            try {
                localStorage.setItem('drawCount', JSON.stringify(drawCount));
            } catch (e) {
                console.log('ä¿å­˜æ¬¡æ•°å¤±è´¥');
            }
        }

        // è·å–å‰©ä½™æ¬¡æ•°
        function getRemainingDraws() {
            const baseRemaining = DAILY_BASE_DRAWS - drawCount.baseUsed;
            const shareRemaining = drawCount.shareEarned - drawCount.shareUsed;
            return baseRemaining + shareRemaining;
        }

        // ä½¿ç”¨ä¸€æ¬¡æŠ½å¥–æœºä¼š
        function useOneDraw() {
            // ä¼˜å…ˆä½¿ç”¨åŸºç¡€æ¬¡æ•°
            if (drawCount.baseUsed < DAILY_BASE_DRAWS) {
                drawCount.baseUsed++;
            } else if (drawCount.shareUsed < drawCount.shareEarned) {
                drawCount.shareUsed++;
            }
            saveDrawCount();
        }

        // åˆ†äº«è·å¾—é¢å¤–æ¬¡æ•°
        function earnShareDraw() {
            if (drawCount.shareEarned < MAX_SHARE_DRAWS) {
                drawCount.shareEarned++;
                saveDrawCount();
                return true;
            }
            return false;
        }

        // æ›´æ–°æ¬¡æ•°æ˜¾ç¤º
        function updateDrawCountDisplay() {
            const remaining = getRemainingDraws();
            const shareEarnable = MAX_SHARE_DRAWS - drawCount.shareEarned;
            
            // åœ¨ç»“æœé¡µæ˜¾ç¤º
            const shareTip = document.querySelector('.share-tip');
            if (shareTip) {
                if (shareEarnable > 0) {
                    shareTip.innerHTML = `
                        ğŸ’¡ <strong>åˆ†äº«ç¦åˆ©ï¼š</strong><br>
                        åˆ†äº«ç»™å¥½å‹ï¼Œè·å– <strong>+1æ¬¡æŠ½å¥–æœºä¼š</strong><br>
                        ä»Šæ—¥å‰©ä½™ <strong>${remaining}æ¬¡</strong> Â· è¿˜å¯åˆ†äº«<strong>${shareEarnable}æ¬¡</strong>
                    `;
                } else {
                    shareTip.innerHTML = `
                        ğŸ’¡ <strong>åˆ†äº«ç¦åˆ©ï¼š</strong><br>
                        ä»Šæ—¥å‰©ä½™ <strong>${remaining}æ¬¡</strong> Â· å·²è¾¾åˆ†äº«ä¸Šé™
                    `;
                }
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        loadDrawCount();
        
        let currentFortune = null;

        // å¼€å§‹æŠ½ç­¾
        function startDraw() {
            // æ£€æŸ¥æ˜¯å¦å·²ä¸­å¥–
            if (drawCount.hasWon) {
                alert('ğŸ‰ æ­å–œæ‚¨ä»Šæ—¥å·²ä¸­å¥–ï¼\n\næ¯äººæ¯å¤©åªèƒ½ä¸­å¥–ä¸€æ¬¡\næ˜å¤©å†æ¥è¯•è¯•è¿æ°”å§ï¼');
                return;
            }
            
            // æ£€æŸ¥å‰©ä½™æ¬¡æ•°
            const remaining = getRemainingDraws();
            if (remaining <= 0) {
                alert('ä»Šæ—¥æŠ½å¥–æ¬¡æ•°å·²ç”¨å®Œï¼\n\nåˆ†äº«ç»™å¥½å‹å¯è·å¾—é¢å¤–æŠ½å¥–æœºä¼š\nï¼ˆæœ€å¤šåˆ†äº«5ä½å¥½å‹ï¼‰');
                return;
            }
            
            // ä½¿ç”¨ä¸€æ¬¡æœºä¼š
            useOneDraw();
            
            document.getElementById('startPage').classList.add('hidden');
            document.getElementById('drawPage').style.display = 'block';
            
            // ç­¾ç­’æ‘‡åŠ¨åŠ¨ç”»
            const sticks = document.querySelectorAll('.stick');
            sticks.forEach(stick => {
                stick.classList.add('shake');
            });
            
            // 2ç§’åæŠ½å‡ºä¸€æ ¹ç­¾
            setTimeout(() => {
                const randomStick = sticks[Math.floor(Math.random() * sticks.length)];
                randomStick.classList.remove('shake');
                randomStick.classList.add('picked');
                
                // å†ç­‰1ç§’æ˜¾ç¤ºç»“æœ
                setTimeout(() => {
                    showResult();
                }, 1000);
            }, 2000);
        }

        // æ ¹æ®æ¦‚ç‡æŠ½å–è¿åŠ¿ï¼ˆè€ƒè™‘é¢åº¦é™åˆ¶ï¼‰
        function getRandomFortune() {
            const random = Math.random();
            let cumulative = 0;
            
            // å…ˆæŒ‰æ¦‚ç‡æŠ½å–
            let selectedFortune = null;
            for (let fortune of fortunes) {
                cumulative += fortune.probability;
                if (random <= cumulative) {
                    selectedFortune = fortune;
                    break;
                }
            }
            
            if (!selectedFortune) {
                selectedFortune = fortunes[fortunes.length - 1];
            }
            
            // æ£€æŸ¥é¢åº¦æ˜¯å¦ç”¨å®Œ
            if (selectedFortune.used >= selectedFortune.quota) {
                // å¦‚æœæŠ½ä¸­çš„å¥–å“å·²ç”¨å®Œï¼Œå¯»æ‰¾è¿˜æœ‰é¢åº¦çš„å¥–å“
                for (let fortune of fortunes) {
                    if (fortune.used < fortune.quota) {
                        selectedFortune = fortune;
                        break;
                    }
                }
            }
            
            // è®°å½•ä½¿ç”¨
            selectedFortune.used++;
            saveQuotas();
            
            return selectedFortune;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult() {
            currentFortune = getRandomFortune();
            
            // å¦‚æœä¸­å¥–ï¼Œæ ‡è®°ä¸ºå·²ä¸­å¥–
            if (currentFortune.isWinning) {
                drawCount.hasWon = true;
                saveDrawCount();
            }
            
            document.getElementById('drawPage').style.display = 'none';
            document.getElementById('resultPage').style.display = 'block';
            
            document.getElementById('resultIcon').textContent = currentFortune.icon;
            document.getElementById('fortuneTitle').textContent = currentFortune.level;
            document.getElementById('fortuneDesc').innerHTML = currentFortune.desc;
            document.getElementById('couponCode').textContent = currentFortune.coupon || '- - -';
            document.getElementById('couponDesc').textContent = currentFortune.discount;
            
            // æ ¹æ®æ˜¯å¦ä¸­å¥–æ˜¾ç¤ºä¸åŒçš„æŒ‰é’®
            const btnGroup1 = document.getElementById('btnGroup1');
            const btnGroup2 = document.getElementById('btnGroup2');
            
            if (currentFortune.isWinning) {
                // ä¸­å¥–äº†ï¼Œæ˜¾ç¤ºè´­ç¥¨æŒ‰é’®ï¼Œéšè—å†æŠ½ä¸€æ¬¡
                btnGroup1.style.display = 'flex';
                btnGroup2.style.display = 'none';
                
                // éšè—ä¼˜æƒ ç å¤åˆ¶æŒ‰é’®ï¼ˆå¦‚æœæ²¡æœ‰ä¼˜æƒ ç ï¼‰
                const copyBtn = document.getElementById('copyCodeBtn');
                if (!currentFortune.coupon) {
                    copyBtn.style.display = 'none';
                } else {
                    copyBtn.style.display = 'block';
                }
            } else {
                // æœªä¸­å¥–ï¼ˆé¡ºï¼‰ï¼Œæ˜¾ç¤ºå†æŠ½ä¸€æ¬¡
                btnGroup1.style.display = 'none';
                btnGroup2.style.display = 'flex';
            }
            
            // æ›´æ–°å‰©ä½™æ¬¡æ•°æ˜¾ç¤º
            updateDrawCountDisplay();
        }

        // å¤åˆ¶ä¼˜æƒ ç 
        function copyCode() {
            const code = currentFortune.coupon;
            
            // åˆ›å»ºä¸´æ—¶inputå…ƒç´ 
            const input = document.createElement('input');
            input.value = code;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            
            // æ˜¾ç¤ºæç¤º
            const toast = document.getElementById('copyToast');
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // è´­ç¥¨ï¼ˆè·³è½¬åˆ°è´­ç¥¨é¡µé¢ï¼‰
        function buyTicket() {
            // è·³è½¬åˆ°è®¾è®¡ä¸Šæµ·è´­ç¥¨é¡µé¢ï¼Œå¹¶å¸¦ä¸Šä¼˜æƒ ç å‚æ•°
            const ticketUrl = 'https://ticket.designshanghai.cn/?f=Baidu&lang=cn&appId=tg8ddf9e4edb76970&referer=https%3A%2F%2Fdesignshanghai.cn%2F';
            const urlWithCoupon = ticketUrl + '&coupon=' + encodeURIComponent(currentFortune.coupon);
            
            // æ‰“å¼€æ–°çª—å£è·³è½¬
            window.open(urlWithCoupon, '_blank');
            
            // ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å½“å‰çª—å£è·³è½¬ï¼Œå–æ¶ˆä¸Šé¢çš„ä»£ç ï¼Œä½¿ç”¨ä¸‹é¢çš„ï¼š
            // window.location.href = urlWithCoupon;
        }

        // é‡æ–°å¼€å§‹
        function restart() {
            // é‡ç½®æ‰€æœ‰é¡µé¢
            document.getElementById('resultPage').style.display = 'none';
            document.getElementById('startPage').classList.remove('hidden');
            
            // é‡ç½®ç­¾ç­’
            const sticks = document.querySelectorAll('.stick');
            sticks.forEach(stick => {
                stick.classList.remove('shake', 'picked');
            });
            
            // æ›´æ–°æ¬¡æ•°æ˜¾ç¤º
            updateStartPageDrawCount();
        }

        // åˆ†äº«ç»™å¥½å‹
        function shareToFriend() {
            const earned = earnShareDraw();
            if (earned) {
                // æ£€æµ‹æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒ
                const isWechat = /micromessenger/i.test(navigator.userAgent);
                
                if (isWechat) {
                    // åœ¨å¾®ä¿¡ä¸­ï¼Œæç¤ºç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
                    alert('ğŸ‰ åˆ†äº«æˆåŠŸï¼\n\nå·²è·å¾— +1 æ¬¡æŠ½å¥–æœºä¼š\n\nè¯·ç‚¹å‡»å³ä¸Šè§’ã€ŒÂ·Â·Â·ã€æŒ‰é’®\né€‰æ‹©ã€Œåˆ†äº«ç»™æœ‹å‹ã€æˆ–ã€Œåˆ†äº«åˆ°æœ‹å‹åœˆã€');
                    // å¾®ä¿¡åˆ†äº«é…ç½®å·²åœ¨é¡µé¢åº•éƒ¨çš„ setupWechatShare() å‡½æ•°ä¸­
                } else {
                    // éå¾®ä¿¡ç¯å¢ƒï¼Œå¤åˆ¶é“¾æ¥
                    const shareUrl = window.location.href;
                    copyToClipboard(shareUrl);
                    alert('ğŸ‰ åˆ†äº«æˆåŠŸï¼\n\nå·²è·å¾— +1 æ¬¡æŠ½å¥–æœºä¼š\næ´»åŠ¨é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\nå¿«å»åˆ†äº«ç»™å¥½å‹å§ï¼');
                }
                
                updateStartPageDrawCount();
            } else {
                alert('ä»Šæ—¥åˆ†äº«æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼ˆ5æ¬¡ï¼‰\næ˜å¤©å†æ¥å§ï¼');
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿è¾…åŠ©å‡½æ•°
        function copyToClipboard(text) {
            const input = document.createElement('input');
            input.value = text;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
        }

        // æ›´æ–°å¼€å§‹é¡µçš„æ¬¡æ•°æ˜¾ç¤º
        function updateStartPageDrawCount() {
            const remaining = getRemainingDraws();
            const shareEarnable = MAX_SHARE_DRAWS - drawCount.shareEarned;
            
            const drawCountText = document.getElementById('drawCountText');
            if (drawCountText) {
                if (drawCount.hasWon) {
                    drawCountText.innerHTML = `ğŸ‰ ä»Šæ—¥å·²ä¸­å¥–ï¼<br><span style="color: #999;">æ¯äººæ¯å¤©åªèƒ½ä¸­å¥–ä¸€æ¬¡ï¼Œæ˜å¤©å†æ¥å§</span>`;
                } else if (remaining > 0) {
                    drawCountText.innerHTML = `ä»Šæ—¥å‰©ä½™ <strong style="color: #667eea;">${remaining}æ¬¡</strong> æŠ½å¥–æœºä¼š`;
                    if (shareEarnable > 0) {
                        drawCountText.innerHTML += `<br>è¿˜å¯é€šè¿‡åˆ†äº«è·å¾—<strong style="color: #764ba2;">${shareEarnable}æ¬¡</strong>é¢å¤–æœºä¼š`;
                    }
                } else {
                    drawCountText.innerHTML = `ä»Šæ—¥æ¬¡æ•°å·²ç”¨å®Œ<br>åˆ†äº«ç»™å¥½å‹å¯è·å¾—é¢å¤–æœºä¼š`;
                }
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°æ˜¾ç¤º
        window.addEventListener('DOMContentLoaded', function() {
            updateStartPageDrawCount();
            setupWechatShare();  // åˆå§‹åŒ–å¾®ä¿¡åˆ†äº«
        });

        // ============ å¾®ä¿¡åˆ†äº«é…ç½® ============
        // é…ç½®å¾®ä¿¡åˆ†äº«åŠŸèƒ½
        function setupWechatShare() {
            // æ£€æµ‹æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒ
            const isWechat = /micromessenger/i.test(navigator.userAgent);
            if (!isWechat) return;

            // å¾®ä¿¡åˆ†äº«é…ç½®
            const shareConfig = {
                title: 'Design Shanghai 2026 æ–°å¹´ç­¾è¿åŠ¿',
                desc: 'æŠ½æ–°å¹´ç­¾ï¼Œèµ¢è®¾è®¡ä¸Šæµ·é—¨ç¥¨ä¼˜æƒ ï¼é©¬åˆ°æˆåŠŸï¼Œå¥½è¿è¿è¿ï¼',
                link: window.location.href,
                imgUrl: window.location.origin + '/share-image.jpg'  // éœ€è¦å‡†å¤‡ä¸€å¼ åˆ†äº«å›¾ç‰‡ï¼ˆå»ºè®®å°ºå¯¸ï¼š300x300ï¼‰
            };

            // âš ï¸ æ³¨æ„ï¼šå¾®ä¿¡åˆ†äº«éœ€è¦åç«¯é…åˆ
            // 1. éœ€è¦åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®JSæ¥å£å®‰å…¨åŸŸå
            // 2. éœ€è¦åç«¯æä¾›ç­¾åæ¥å£
            
            // ä»¥ä¸‹æ˜¯å®Œæ•´é…ç½®ç¤ºä¾‹ï¼Œéœ€è¦æ›¿æ¢ä¸ºå®é™…çš„åç«¯ç­¾åæ¥å£
            /*
            // è°ƒç”¨åç«¯æ¥å£è·å–å¾®ä¿¡ç­¾å
            fetch('/api/wechat/signature?url=' + encodeURIComponent(location.href.split('#')[0]))
                .then(res => res.json())
                .then(data => {
                    // é…ç½®å¾®ä¿¡JS-SDK
                    wx.config({
                        debug: false,  // ç”Ÿäº§ç¯å¢ƒè®¾ä¸ºfalse
                        appId: data.appId,  // å…¬ä¼—å·çš„å”¯ä¸€æ ‡è¯†
                        timestamp: data.timestamp,  // ç”Ÿæˆç­¾åçš„æ—¶é—´æˆ³
                        nonceStr: data.nonceStr,  // ç”Ÿæˆç­¾åçš„éšæœºä¸²
                        signature: data.signature,  // ç­¾å
                        jsApiList: [
                            'updateAppMessageShareData',  // åˆ†äº«ç»™æœ‹å‹
                            'updateTimelineShareData'     // åˆ†äº«åˆ°æœ‹å‹åœˆ
                        ]
                    });

                    wx.ready(function() {
                        // åˆ†äº«ç»™æœ‹å‹
                        wx.updateAppMessageShareData({
                            title: shareConfig.title,
                            desc: shareConfig.desc,
                            link: shareConfig.link,
                            imgUrl: shareConfig.imgUrl,
                            success: function() {
                                console.log('åˆ†äº«ç»™æœ‹å‹é…ç½®æˆåŠŸ');
                            }
                        });

                        // åˆ†äº«åˆ°æœ‹å‹åœˆ
                        wx.updateTimelineShareData({
                            title: shareConfig.title,
                            link: shareConfig.link,
                            imgUrl: shareConfig.imgUrl,
                            success: function() {
                                console.log('åˆ†äº«åˆ°æœ‹å‹åœˆé…ç½®æˆåŠŸ');
                            }
                        });
                    });

                    wx.error(function(res) {
                        console.error('å¾®ä¿¡JS-SDKé…ç½®å¤±è´¥', res);
                    });
                })
                .catch(err => {
                    console.error('è·å–å¾®ä¿¡ç­¾åå¤±è´¥', err);
                });
            */
        }

        // ç»Ÿè®¡æ•°æ®ï¼ˆå¯é€‰ï¼‰
        function trackEvent(eventName, data) {
            // è¿™é‡Œå¯ä»¥æ¥å…¥å®é™…çš„æ•°æ®ç»Ÿè®¡å·¥å…·
            // ä¾‹å¦‚ï¼šç™¾åº¦ç»Ÿè®¡ã€Google Analyticsã€å‹ç›Ÿç­‰
            console.log('Event:', eventName, data);
        }

        // é‡ç½®é¢åº¦ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼‰
        // ä½¿ç”¨æ–¹æ³•ï¼šæ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œè¾“å…¥ resetQuotas() ç„¶åæŒ‰å›è½¦
        function resetQuotas() {
            fortunes.forEach(f => f.used = 0);
            saveQuotas();
            console.log('âœ“ é¢åº¦å·²é‡ç½®');
            alert('é¢åº¦å·²é‡ç½®ï¼');
        }

        // æŸ¥çœ‹å½“å‰é¢åº¦ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
        // ä½¿ç”¨æ–¹æ³•ï¼šæ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œè¾“å…¥ checkQuotas() ç„¶åæŒ‰å›è½¦
        function checkQuotas() {
            console.log('=== å½“å‰é¢åº¦æƒ…å†µ ===');
            fortunes.forEach(f => {
                const remaining = f.quota - f.used;
                console.log(`${f.level} (${f.coupon}): ${remaining}/${f.quota} å‰©ä½™`);
            });
        }

        // é‡ç½®æ¯æ—¥æŠ½å¥–æ¬¡æ•°ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
        function resetDailyDraws() {
            drawCount = {
                date: new Date().toDateString(),
                baseUsed: 0,
                shareUsed: 0,
                shareEarned: 0,
                hasWon: false
            };
            saveDrawCount();
            updateStartPageDrawCount();
            console.log('âœ“ æ¯æ—¥æ¬¡æ•°å·²é‡ç½®');
            alert('æ¯æ—¥æ¬¡æ•°å·²é‡ç½®ï¼');
        }

        // æŸ¥çœ‹å½“å‰æŠ½å¥–æ¬¡æ•°æƒ…å†µï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
        function checkDrawCount() {
            const remaining = getRemainingDraws();
            const shareEarnable = MAX_SHARE_DRAWS - drawCount.shareEarned;
            console.log('=== å½“å‰æŠ½å¥–æ¬¡æ•°æƒ…å†µ ===');
            console.log(`æ—¥æœŸ: ${drawCount.date}`);
            console.log(`åŸºç¡€æ¬¡æ•°: ${drawCount.baseUsed}/${DAILY_BASE_DRAWS} å·²ç”¨`);
            console.log(`åˆ†äº«è·å¾—: ${drawCount.shareEarned}/${MAX_SHARE_DRAWS} æ¬¡`);
            console.log(`åˆ†äº«å·²ç”¨: ${drawCount.shareUsed}/${drawCount.shareEarned} æ¬¡`);
            console.log(`å‰©ä½™æ¬¡æ•°: ${remaining} æ¬¡`);
            console.log(`è¿˜å¯åˆ†äº«: ${shareEarnable} æ¬¡`);
        }
    </script>
</body>
</html>